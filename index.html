<!DOCTYPE html>
<html>
    <head>
        <title>Matthew Bierman</title>
        
        <style type="text/css">
            body {
                margin: 0;
                padding 0;
            }
            #background {
                position: fixed;
                transition: 0.5s;
            }
            #gameOfLife {
                position: fixed;
            }
        </style>
    </head>
    <body>
        <div id="background"></div>
        <canvas id="gameOfLife"></canvas>
        
        <!-- jQuery -->
        <script src="jquery-3.2.1.min.js"></script>
        <!-- JavaScript -->
        <script type="text/javascript">
            // general functions
            function print2dArray(arr) {
                var str = "";
                for (var i = 0; i < arr[0].length; i++)
                {
                    str += "[ ";
                    for (var j = 0; j < arr.length; j++)
                    {
                        if (j == arr.length - 1)
                            str += arr[j][i] + " ";
                        else
                            str += arr[j][i] + ", ";
                    }
                    str += "]\n";
                }
                console.log(str);
            }
            function clone(arr) {
                var xCoordCells = arr.length;
                var yCoordCells = arr[0].length;                
                
                var newArr = new Array(xCoordCells);
                for (var i = 0; i < xCoordCells; i++)
                {
                    newArr[i] = new Array(yCoordCells);
                    for (var j = 0; j < yCoordCells; j++)
                        newArr[i][j] = arr[i][j];
                }
                
                return newArr;
            }
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            // functions for the canvas
            async function run(cells, ms) {
                var currWindowHeight = $(window).height();
                var currWindowWidth = $(window).width();
                var prevWindowHeight = currWindowHeight;
                var prevWindowWidth = currWindowWidth;
                
                // while the window size doesn't change while the game is running
                while (currWindowHeight == prevWindowHeight && currWindowWidth == prevWindowWidth)
                {
                    await sleep(ms);
                    cells = step(gridSize, cells);
                    drawAllCells(canvas, gridSize, cells);
                                        
                    prevWindowHeight = currWindowHeight;
                    prevWindowWidth = currWindowWidth;
                    currWindowHeight = $(window).height();
                    currWindowWidth = $(window).width();
                }
            }
            function setCanvasGrid(canvas, gridSize, addHeight) {
                canvas.height = $(window).height();
                canvas.width = $(window).width();
                
                $("body").height(canvas.height + addHeight);
                $("body").width(canvas.width);
                
                if (canvas.getContext)
                {
                    var ctx = canvas.getContext("2d");
                    ctx.fillStyle = 'white';
                    
                    for (var i = 1; i <= Math.floor(canvas.width / gridSize); i++)
                        ctx.fillRect((gridSize * i) - 1, 0, 2, canvas.height);
                    
                    for (var i = 1; i <= Math.floor(canvas.height / gridSize); i++)
                        ctx.fillRect(0, (gridSize * i) - 1, canvas.width, 2);
                }
            }
            function drawCell(canvas, x, y, gridSize, cellColor) {
                if (canvas.getContext)
                {
                    var ctx = canvas.getContext("2d");
                    ctx.fillStyle = cellColor;
                    
                    // cell at (0, 0)
                    if (x == 0 && y == 0)
                    {
                        ctx.clearRect(x, y, gridSize - 1, gridSize - 1);
                        ctx.fillRect(x, y, gridSize - 1, gridSize - 1);
                    }
                    
                    // first row
                    else if (y == 0)
                    {
                        ctx.clearRect((x * gridSize) + 1, (y * gridSize), gridSize - 2, gridSize - 1);
                        ctx.fillRect((x * gridSize) + 1, (y * gridSize), gridSize - 2, gridSize - 1);
                    }
                    
                    // first column
                    else if (x == 0)
                    {
                        ctx.clearRect((x * gridSize), (y * gridSize) + 1, gridSize - 1, gridSize - 2);
                        ctx.fillRect((x * gridSize), (y * gridSize) + 1, gridSize - 1, gridSize - 2);
                    }
                    
                    // all other cells
                    else
                    {
                        ctx.clearRect((x * gridSize) + 1, (y * gridSize) + 1, gridSize - 2, gridSize - 2);
                        ctx.fillRect((x * gridSize) + 1, (y * gridSize) + 1, gridSize - 2, gridSize - 2);
                    }
                }
            }
            function drawAllCells(canvas, gridSize, cells) {
                for (var i = 0; i < cells.length; i++)
                {
                    for (var j = 0; j < cells[0].length; j++)
                    {
                        if (cells[i][j] == 0)
                            drawCell(canvas, i, j, gridSize, 'black');
                        else
                            drawCell(canvas, i, j, gridSize, 'transparent');
                    }
                }
            }
            function initialState(canvas, gridSize) {
                // Get maximum number of cells for rows and columns
                var xCoordCells = Math.ceil(canvas.width / gridSize);
                var yCoordCells = Math.ceil(canvas.height / gridSize);
                
                // Create 2D array for cells
                var cells = new Array(xCoordCells);
                for (var i = 0; i < xCoordCells; i++)
                {
                    cells[i] = new Array(yCoordCells);
                    for (var j = 0; j < yCoordCells; j++)
                        cells[i][j] = 0;
                }
                
                // Initial state
                cells[2][2] = 1;
                cells[3][3] = 1;
                cells[3][4] = 1;
                cells[2][4] = 1;
                cells[1][4] = 1;               
                
                // Draw cells at their initial state
                for (var i = 0; i < xCoordCells; i++) {
                    for (var j = 0; j < yCoordCells; j++)
                    {
                        if (cells[i][j] == 0)
                            drawCell(canvas, i, j, gridSize, 'black');
                        else
                            drawCell(canvas, i, j, gridSize, 'transparent');
                    }
                }
                
                return cells;
            }
            function step(gridSize, cells) {
                var nextGeneration = clone(cells);
                
                // for every cell in the grid
                for (var i = 0; i < cells.length; i++)
                {
                    for (var j = 0; j < cells[0].length; j++)
                    {
                        var liveNeighbors = 0;
                        
                        // create 3x3 array for neighboring cells
                        var neighborCells = new Array(3);
                        for (var k = 0; k < 3; k++)
                        {
                            neighborCells[k] = new Array(3);
                            for (var l = 0; l < 3; l++)
                                neighborCells[k][l] = -1;
                        }
                        
                        // center is the cell itself
                        neighborCells[1][1] = "*";
                        
                        // if no cells exist on its left
                        if (i == 0)
                        {
                            neighborCells[0][0] = "N";
                            neighborCells[1][0] = "N";
                            neighborCells[2][0] = "N";
                        }
                        
                        // if no cells exist above it
                        if (j == 0)
                        {
                            neighborCells[0][0] = "N";
                            neighborCells[0][1] = "N";
                            neighborCells[0][2] = "N";
                        }
                        
                        // if no cells exist on its right
                        if (i == cells.length - 1)
                        {
                            neighborCells[0][2] = "N";
                            neighborCells[1][2] = "N";
                            neighborCells[2][2] = "N";
                        }
                        
                        // if no cells exist below it
                        if (j == cells[0].length - 1)
                        {
                            neighborCells[2][0] = "N";
                            neighborCells[2][1] = "N";
                            neighborCells[2][2] = "N";
                        }
                        
                        // check if neighboring cells are occupied
                        for (var k = 0; k < 3; k++)
                        {
                            for (var l = 0; l < 3; l++)
                            {
                                // if neighbor is out-of-bounds, wrap around to the opposite side of the grid
                                if (neighborCells[k][l] == "N")
                                {
                                    // top left
                                    if ((k == 0) && (l == 0) && (cells[((i - 1) == -1) ? (cells.length - 1) : (i - 1)][((j - 1) == -1) ? (cells[0].length - 1) : (j - 1)] != 0))
                                            liveNeighbors++;
                                    // center left
                                    else if ((k == 1) && (l == 0) && (cells[((i - 1) == -1) ? (cells.length - 1) : (i - 1)][j] != 0))
                                            liveNeighbors++;
                                    // bottom left
                                    else if ((k == 2) && (l == 0) && (cells[((i - 1) == -1) ? (cells.length - 1) : (i - 1)][((j + 1) == cells[0].length) ? 0 : (j + 1)] != 0))
                                            liveNeighbors++;
                                    // top middle
                                    else if ((k == 0) && (l == 1) && (cells[i][((j - 1) == -1) ? (cells[0].length - 1) : (j - 1)] != 0))
                                            liveNeighbors++;
                                    // bottom middle
                                    else if ((k == 2) && (l == 1) && (cells[i][((j + 1) == cells[0].length) ? 0 : (j + 1)] != 0))
                                            liveNeighbors++;
                                    // top right
                                    else if ((k == 0) && (l == 2) && (cells[((i + 1) == cells.length) ? 0 : (i + 1)][((j - 1) == -1) ? (cells[0].length - 1) : (j - 1)] != 0))
                                            liveNeighbors++;
                                    // center right
                                    else if ((k == 1) && (l == 2) && (cells[((i + 1) == cells.length) ? 0 : (i + 1)][j] != 0))
                                            liveNeighbors++;
                                    // bottom right
                                    else if ((k == 2) && (l == 2) && (cells[((i + 1) == cells.length) ? 0 : (i + 1)][((j + 1) == cells[0].length) ? 0 : (j + 1)] != 0))
                                            liveNeighbors++;
                                }
                                // if not itself, which is at (1, 1)
                                else if (neighborCells[k][l] != "*")
                                {
                                    // top left
                                    if ((k == 0) && (l == 0) && (cells[i - 1][j - 1] != 0))
                                        liveNeighbors++;
                                    // center left
                                    else if ((k == 1) && (l == 0) && (cells[i - 1][j] != 0))
                                        liveNeighbors++;
                                    // bottom left
                                    else if ((k == 2) && (l == 0) && (cells[i - 1][j + 1] != 0))
                                        liveNeighbors++;
                                    // top middle
                                    else if ((k == 0) && (l == 1) && (cells[i][j - 1] != 0))
                                        liveNeighbors++;
                                    // bottom middle
                                    else if ((k == 2) && (l == 1) && (cells[i][j + 1] != 0))
                                        liveNeighbors++;
                                    // top right
                                    else if ((k == 0) && (l == 2) && (cells[i + 1][j - 1] != 0))
                                        liveNeighbors++;
                                    // center right
                                    else if ((k == 1) && (l == 2) && (cells[i + 1][j] != 0))
                                        liveNeighbors++;
                                    // bottom right
                                    else if ((k == 2) && (l == 2) && (cells[i + 1][j + 1] != 0))
                                        liveNeighbors++;
                                }
                            }
                        }
                        
                        // any dead cell with exactly three live neighbours becomes a live cell
                        if (cells[i][j] == 0 && liveNeighbors == 3)
                            nextGeneration[i][j] = 1;
                    
                        // any live cell with two or three live neighbours stays alive, any live cell with fewer than two live neighbours or more than three live neighbours dies
                        else if (cells[i][j] == 1 && (liveNeighbors < 2 || liveNeighbors > 3))
                            nextGeneration[i][j] = 0;
                    }
                }
                
                return nextGeneration;
            }
           
            // functions for the background
            function setBackgroundColor() {                
                if ($(this).scrollTop() >= 0 && $(this).scrollTop() < 200)
                    $("#background").css("background-color", "red");
                else if ($(this).scrollTop() >= 200 && $(this).scrollTop() < 400)
                    $("#background").css("background-color", "green");
                else if ($(this).scrollTop() >= 400 && $(this).scrollTop() < 600)
                    $("#background").css("background-color", "blue");
                else
                    $("#background").css("background-color", "yellow");
            }
            function setBackgroundSize() {
                $("#background").height($(window).height());
                $("#background").width($(window).width());
            }
            $(document).ready(function() {
                setBackgroundSize();
                setBackgroundColor();
            });
            $(function changeColor() {
                $(window).scroll(function() {
                    setBackgroundColor();
                });
            });
            
            var gridSize = 50; // in pixels
            var stepDelay = 100; // in milliseconds
            var canvas = document.getElementById("gameOfLife");
            
            setCanvasGrid(canvas, gridSize, 1000);
            var cells = initialState(canvas, gridSize);

            run(cells, stepDelay);
            
            // Grid is redrawn after every time the window is resized
            $(window).resize(function() {
                setBackgroundSize();
                setCanvasGrid(canvas, gridSize, 0);
                cells = initialState(canvas, gridSize);
                drawAllCells(canvas, gridSize, cells);
                run(cells, stepDelay);
            });
        </script>
    </body>
</html>